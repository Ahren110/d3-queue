(function(){function n(n){function t(){for(;l=f.length>a&&n>p;){var t=a++,u=f[t],o=e.call(u,1);o.push(i(t)),++p,u[0].apply(null,o)}}function i(n){return function(u,e){--p,null==d&&(null!=u?(d=u,a=s=0/0,o()):(f[n]=e,--s?l||t():o()))}}function o(){null!=d?h(d):c?h(d,f):h.apply(null,[d].concat(f))}var r,l,c,f=[],a=0,p=0,s=0,d=null,h=u;return n||(n=1/0),r={defer:function(){return d||(f.push(arguments),++s,t()),r},await:function(n){return h=n,c=!1,s||o(),r},awaitAll:function(n){return h=n,c=!0,s||o(),r}}}function t(n,e){return{then:function(i,o){var r=u;return o||(o=e),n(function(n){n.await(function(n){return n?void o.call(this,n):(r(i.apply(this,[].slice.call(arguments,1))),void 0)})}),t(function(n){r=n},o)}}}function u(){}var e=[].slice;n.then=function(n,u){var e=n();return t(function(n){n(e)},u)},n.version="1.0.7","function"==typeof define&&define.amd?define(function(){return n}):"object"==typeof module&&module.exports?module.exports=n:this.queue=n})();